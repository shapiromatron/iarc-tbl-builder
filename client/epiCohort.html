<template name="epiCohortMain">
    <div class="container">
        <h1>{{name}}.</h1>
        {{> epiCohortTbl}}
        <a href="{{pathFor 'my_lists'}}">Home</a>
        <a href="{{pathFor 'in_vitro'}}">In vitro!</a>
    </div>
</template>

<template name="epiCohortTbl">
    <table class="table table-compressed table-striped">
        <colgroup>
            <col style="width:18%">
            <col style="width:10%">
            <col style="width:15%">
            <col style="width:10%">
            <col style="width:10%">
            <col style="width:7%">
            <col style="width:10%">
            <col style="width:20%">
        </colgroup>
        <thead>
            <tr>
                <th>Reference, <br>location, <br>follow-up period</th>
                <th>Total No. of subjects</th>
                <th>Exposure Assessment</th>
                <th>Organ site<br>(ICD Code)</th>
                <th>Exposure<br>categories</th>
                <th>Exposed<br>cases</th>
                <th>Relative risk<br>(95% CI)</th>
                <th>Covariates &amp;<br>Comments</th>
            </tr>
        </thead>
        <tbody>
            {{#each getEpiCohorts}}
            <tr class="menu-autohide" data-id="{{_id}}" data-sortIdx="{{sortIdx}}">
                {{#if epiCohortIsEditing}}
                    <td colspan="100">
                        {{> epiCohortForm this epiCohortNew="F"}}
                    </td>
                {{else}}
                    <td>
                        <div class="rowOptions btn-group pull-right">
                          <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown">
                            <span class="caret" title="Editing options"></span>
                          </button>
                          <ul class="dropdown-menu">
                            <li><a href="#" id="epiCohort-show-edit"><span class="glyphicon glyphicon-edit"></span> Edit</a></li>
                            <li><a href="#" id="epiCohort-move-up"><span class="glyphicon glyphicon-arrow-up"></span> Move up</a></li>
                            <li><a href="#" id="epiCohort-move-down"><span class="glyphicon glyphicon-arrow-down"></span> Move down</a></li>
                          </ul>
                        </div>
                        {{{referenceFormat reference reference_url}}}<br>{{location}}<br>{{followUpPeriod}}
                    </td>
                    <td>{{numSubjects}} {{numSubjectsText}}</td>
                    <td>{{exposureAssessment}}</td>
                    <td colspan="4">
                        {{> epiCohortExposureTbl epiCohort=this epiCohortExposureEditable="F" }}
                    </td>
                    <td>{{covariates}}<br>{{comments}}</td>
                {{/if}}
            </tr>
            {{/each}}
        </tbody>
    </table>

    {{#if epiCohortShowNew}}
        {{> epiCohortForm epiCohortNew="T"}}
    {{else}}
        <button class="btn btn-primary" id='epiCohort-show-create'><i class="glyphicon glyphicon-plus"></i> New</button>
    {{/if}}
</template>

<template name="epiCohortForm">
    <form id="epiCohortForm" role="form" class="editForm">
        <div class="form-group row">
            <div class="col-xs-4">
                <label>Reference and Reference URL</label>
                <input class="form-control" name='reference' type="text" value="{{reference}}" placeholder='Enter the reference, such as "Smith et al. (2005)"' /><br>
                <input class="form-control" name='reference_url' type="url" value="{{reference_url}}" placeholder='Enter the reference URL, if available' />
            </div>
            <div class="col-xs-4">
                <label>Cohort Location</label>
                <input class="form-control" name='location' type="text" value="{{location}}"/>
            </div>
            <div class="col-xs-4">
                <label>Follow-up period</label>
                <input class="form-control" name='followUpPeriod' type="text" value="{{followUpPeriod}}"/>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-xs-4">
                <label>Number of Subjects</label>
                <input class="form-control" name='numSubjects' type="number" value="{{numSubjects}}" placeholder="Numeric" />
            </div>
            <div class="col-xs-8">
                <label>Number of Subjects (text-details)</label>
                <input class="form-control" name='numSubjectsText' type="text" value="{{numSubjectsText}}"/>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-xs-4">
                <label>Exposure assessment details</label>
                <textarea class="form-control" name='exposureAssessment' rows="3">{{exposureAssessment}}</textarea>
            </div>
            <div class="col-xs-4">
                <label>Covariates</label>
                <textarea class="form-control" name='covariates' rows="3">{{covariates}}</textarea>
            </div>
            <div class="col-xs-4">
                <label>Comments</label>
                <textarea class="form-control" name='comments' rows="3">{{comments}}</textarea>
            </div>
        </div>

        <div class="well well-sm pager">
        {{#if epiCohortIsNew epiCohortNew }}
            <button type="button" class="btn btn-sm btn-primary" id="epiCohort-create" title="Save new"><span class="glyphicon glyphicon-ok"> Create</span></button>
            <button type="button" class="btn btn-sm btn-default" id="epiCohort-create-cancel" title="Cancel">Cancel</button>
        {{else}}
            <button type="button" class="btn btn-sm btn-primary" id="epiCohort-update" title="Save changes"><span class="glyphicon glyphicon-ok"> Save</span></button>
            <button type="button" class="btn btn-sm btn-default" id="epiCohort-update-cancel" title="Cancel changes">Cancel</button>
            <button type="button" class="btn btn-sm btn-danger"  id="epiCohort-delete" title="Delete row"><span class="glyphicon glyphicon-trash"></span></button>
        {{/if}}
        </div>
    </form>

    {{#unless epiCohortIsNew epiCohortNew }}
        {{> epiCohortExposureTbl epiCohort=this epiCohortExposureEditable="T"}}
    {{/unless}}
</template>
