<template name="epiMain">
  <div class="container">
    {{> epiDescriptiveForm}}
    <!-- {{> epiResultsForm}} -->
  </div>
</template>

<template name="epiDescriptiveForm">
  <form id="epiResultsForm" role="form" class="editForm">
    <legend>Epidemiological Cohort Description</legend>
    <p class="help-block">Hover-over field labels for more descriptive text.</p>

    <!-- First row -->
    <div class="form-group row">
      <div class="col-xs-3">
        {{> referenceSingleSelect}}
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Study-design used for evaluation (Prospective Cohort, Case-Control, etc.) ">
              Study design</label>
        {{> selectList options=getStudyDesignOptions selected=studyDesign selectName="studyDesign" }}
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Country; other information (e.g., region, state, province, city) if important">
              Location</label>
        <input class="form-control" type="text"
               name='location'
               value="{{location}}"/>
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Enrollment for case-control studies, follow-up for cohort studies">
               Enrollment or follow-up date</label>
        <input class="form-control" type="text"
               name='enrollmentDates'
               value="{{enrollmentDates}}"/>
      </div>
    </div>

    <!-- Second row -->
    <div class="form-group row">

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Industry or occupation (e.g., transformer repair
                             workers); cohort name (e.g., Nurses' Health Study);
                             source of population (e.g., participants in the
                             population census, registered voters, source cohort
                             for nested case-control studies)">
                Population description</label>
        <textarea class="form-control"
                  name='populationDescription'
                  rows="4">{{populationDescription}}</textarea>
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Any additional criteria for inclusion/exclusion
                             (e.g., age, sex, race, length of employment).
                             Provide for cases and controls in case-control studies.">
                Eligibility criteria</label>
        <textarea class="form-control"
                  name='strengths'
                  rows="4">{{strengths}}</textarea>
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Approach used to estimate exposure, if any
                            (quantitative measurement, JEM questionnaire, expert
                            judgement, biomonitoring, other)">
              Exposure assessment method</label>
        <textarea class="form-control"
                  name='exposureAssessmentMethod'
                  rows="4">{{exposureAssessmentMethod}}</textarea>
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Method of follow-up or source of outcome data (e.g.
                            linkage to natinoal cancer registry, searches of
                            death certificates, insurace records, etc.)">
              Outcome data source</label>
        <textarea class="form-control"
                  name='outcomeDataSource'
                  rows="4">{{outcomeDataSource}}</textarea>
      </div>
    </div>

    <!-- Third row -->
    <div class="form-group row">

      <div class="col-xs-4 isNotCCinput">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Number enrolled for cohort studies which were
                             included in the analysis after exclusions">
               Population size</label>
        <input class="form-control" type="number"
               name='populationSize'
               value="{{populationSize}}"/>
      </div>
      <div class="col-xs-3 isCCinput">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Number of cases in case-control study which were
                             included in the analysis after exclusions">
               Cases: population size</label>
        <input class="form-control" type="number"
               name='populationSizeCase'
               value="{{populationSizeCase}}"/>
      </div>
      <div class="col-xs-3 isCCinput">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Number of controls in case-control study which were
                             included in the analysis after exclusions">
               Controls: population size</label>
        <input class="form-control" type="number"
               name='populationSizeControl'
               value="{{populationSizeControl}}"/>
      </div>

      <div class="col-xs-6 isCCinput">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Note disease definition and whether incident for
                             cases. For hospital clinical/registry controls note
                             disease(s) if relevant (e.g., other cancers, non-
                             smoking related disease)">
                Source of cases and controls</label>
        <textarea class="form-control"
                  name='sourceCaseControls'
                  rows="2">{{sourceCaseControls}}</textarea>
      </div>
    </div>

    <!-- Fourth row -->
    <div class="form-group row">

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Percent of eligible participants included
                            (for cases and controls in case-control studies)">
              Response rates</label>
        <input class="form-control" type="number" step="any"
               name='responseRate'
               value="{{responseRate}}"
               placeholder="Leave blank if unknown"/>
      </div>


      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Enrollment for case-control studies, follow-up for cohort studies">
               Type of referent group</label>
        <input class="form-control" type="text"
               name='referentGroup'
               value="{{referentGroup}}"/>
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Average exposure level or range">
               Exposure level</label>
        <input class="form-control" type="text"
               name='exposureLevel'
               value="{{exposureLevel}}"/>
      </div>

      <div class="col-xs-3">
        <label class="helpPopovers" data-toggle="popover"
               data-content="e.g., multiple logistic regression, lifetable, Mantel-Haenzel, etc.">
               Analytical method</label>
        <input class="form-control" type="text"
               name='analyticalMethod'
               value="{{analyticalMethod}}"/>
      </div>
    </div>

    <!-- Fifth row -->
    <div class="form-group row">

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Any study-strengths should be described here.">
                Principal strengths</label>
        <textarea class="form-control"
                  name='strengths'
                  rows="3">{{strengths}}</textarea>
      </div>

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Limitations to consider include the extent to which
                             chance, bias, and confounding could explain the results">
                Principal limitations</label>
        <textarea class="form-control"
                  name='limitations'
                  rows="3">{{limitations}}</textarea>
      </div>

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Any other general comments related to the study">
              General Notes</label>
        <textarea class="form-control"
                  name='notes'
                  rows="3">{{notes}}</textarea>
      </div>
    </div>

    <div id="errors"></div>

    <!-- Submission -->
    <div class="well well-sm pager">
      {{#if epiRiskEstimateIsNew }}
        <button type="button" class="btn btn-sm btn-primary"
                id="epiDescriptive-create" title="Save new">
                <span class="glyphicon glyphicon-ok"></span> Create</button>
        <button type="button" class="btn btn-sm btn-default"
                id="epiDescriptive-create-cancel" title="Cancel">Cancel</button>
      {{else}}
        <button type="button" class="btn btn-sm btn-primary"
                id="epiDescriptive-update" title="Save changes">
                <span class="glyphicon glyphicon-ok"></span> Save</button>
        <button type="button" class="btn btn-sm btn-default"
                id="epiDescriptive-update-cancel" title="Cancel changes"> Cancel</button>
        <button type="button" class="btn btn-sm btn-danger"
                id="epiDescriptive-delete" title="Delete row">
                <span class="glyphicon glyphicon-trash"></span></button>
        <button type="button" class="pull-left btn btn-sm btn-primary"
                data-toggle="modal"
                data-target="#epiResultsModal"
                title="Display modal for entering results">
                <span class="fa fa-medkit"></span> Add results</button>
      {{/if}}
    </div>
  </form>
  <!-- Add input form-modals outside form scope -->
  {{> referenceQuickAddModal}}
  {{> epiResultsModal}}
</template>

<template name="epiResultsForm">
  <form id="epiResultsForm" role="form" class="editForm">
    {{#unless isModal}}
      <legend>Results data capture</legend>
    {{/unless}}
    <p class="help-block">Hover-over field labels for more descriptive text.</p>

    <!-- First row -->
    <div class="form-group row">
      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Cancer site for results being measured.">
               Cancer Site</label>
        <br>
        <input class="form-control" type="text"
               name='cancerSite'
               value="{{cancerSite}}"
               placeholder="dropdown-list"/>
      </div>

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Deaths/cases for cohort studies; Cases for case-control studies">
              Number exposed</label>
        <input class="form-control" type="text"
               name='numberExposed'
               value="{{numberExposed}}"/>
      </div>

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Units, if relevant (e.g., risk per 10 μg/m3)">
              Units of effect measurement</label>
        <input class="form-control" type="text"
               name='effectUnits'
               value="{{effectUnits}}"
               placeholder="dropdown-list"/>
      </div>
    </div>

    <!-- Second row -->
    <div class="form-group row">

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Risk metric used to display results (SMR, RR, etc.)">
               Description of effect measure</label>
        <input class="form-control" type="text"
               name='effectMeasure'
               value="{{effectMeasure}}"
               placeholder="dropdown-list"/>
      </div>

      <div class="col-xs-4">
          <!-- spacer -->
      </div>

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
              data-content="Trend test, provide for categorical analysis when reported">
              Trend test</label>
        <input class="form-control" type="number" step="any"
               name='trendTest'
               value="{{trendTest}}"/>
      </div>
    </div>

    <!-- Risk estimates -->
    <table class="table table-condensed">
      <thead>
        <th>
          <span class="helpPopovers" data-toggle="popover"
                data-content="E.g., all exposed workers, second quartile of exposure,
                            quantitative exposure level (always provide quantitative
                            information when available)">
                Exposure category<br>or level
          </span>
        </th>
        <th>
          <span class="helpPopovers" data-toggle="popover"
                data-content="Central risk reported for risk estimate">
                Risk estimate<br>midpoint
          </span>
        </th>
        <th>
          <span class="helpPopovers" data-toggle="popover"
                data-content="95% lower confidence interval risk estimate">
                Risk estimate<br>95% lower CI
          </span>

        </th>
        <th>
          <span class="helpPopovers" data-toggle="popover"
                data-content="95% upper confidence interval risk estimate">
                 Risk estimate<br>95% upper CI
          </span>
        </th>
        <th>
          <span class="helpPopovers" data-toggle="popover"
                data-content="Risk was estimated by reviewers, not study-authors">
                Estimated<br>&nbsp;
          </span>
        </th>
        <th>
            <button type="button" class="btn btn-xs btn-info"
                    id="epiRiskEstimate-add" title="Add row">
                    <span class="glyphicon glyphicon-plus"></span></button>
        </th>
      </thead>
      <tbody class="riskEstimateTbody">
        {{#if riskEstimates}}
          {{#each riskEstimates}}
            {{> riskEstimateForm this}}
          {{/each}}
        {{else}}
          {{> riskEstimateForm}}
        {{/if}}
      </tbody>
    </table>

    <!-- Final row -->
    <div class="form-group row">

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="List all covariates which were controlled by matching or
                             adjustment in the analysis reported">
               Covariates controlled</label>
        <input class="form-control" type="text"
               name='covariatesControlled'
               value="{{covariatesControlled}}"
               placeholder="dropdown-list"/>
      </div>

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Further describe how covariates were controlled, if needed,
                             such as details on matching methodology or adjustments made">
                Covariates controlled notes</label>
        <textarea class="form-control"
                  name='covariatesControlledText'
                  rows="4">{{covariatesControlledText}}</textarea>
      </div>

      <div class="col-xs-4">
        <label class="helpPopovers" data-toggle="popover"
               data-content="Note issues related to appropriateness of comparison
                             groups, potential for uncontrolled confounding, etc.">
              General Notes</label>
        <textarea class="form-control"
                  name='notes'
                  rows="4">{{notes}}</textarea>
      </div>
    </div>

    <div id="errors"></div>

    <!-- Submission -->
    <div class="well well-sm pager">
      {{#if epiRiskEstimateIsNew }}
        <button type="button" class="btn btn-sm btn-primary"
                id="epiRiskEstimate-create" title="Save new">
                <span class="glyphicon glyphicon-ok"></span> Create</button>
        <button type="button" class="btn btn-sm btn-default"
                id="epiRiskEstimate-create-cancel" title="Cancel"
                data-dismiss={{# if isModal}}modal{{/if}}>Cancel</button>
      {{else}}
        <button type="button" class="btn btn-sm btn-primary"
                id="epiRiskEstimate-update" title="Save changes">
                <span class="glyphicon glyphicon-ok"> Save</span></button>
        <button type="button" class="btn btn-sm btn-default"
                id="epiRiskEstimate-update-cancel" title="Cancel changes"
                data-dismiss={{# if isModal}}modal{{/if}}>Cancel</button>
        <button type="button" class="btn btn-sm btn-danger"
                id="epiRiskEstimate-delete" title="Delete row"
                data-dismiss={{# if isModal}}modal{{/if}}>
                <span class="glyphicon glyphicon-trash"></span></button>
      {{/if}}
    </div>
  </form>
</template>

<template name="riskEstimateForm">
  <tr>
    <td>
      <input class="form-control" type="text"
             name='exposureCategory'
             value="{{exposureCategory}}"/>
    </td>
    <td>
        <input class="form-control" type="number" step="any"
               name='riskMid'
               value="{{riskMid}}"/>
    </td>
    <td>
        <input class="form-control" type="number" step="any"
               name='riskLow'
               value="{{riskLow}}"/>
    </td>
    <td>
        <input class="form-control" type="number" step="any"
               name='riskHigh'
               value="{{riskHigh}}"/>
    </td>
    <td>
      <div class="checkbox">
        <input type="checkbox" name='riskEstimated'
               checked="{{riskEstimated}}"
               title="Check if risk was estimated by reviewer, not study-author"/>
      </div>
    </td>
    <td class="text-center" style="vertical-align: middle;">
      <button type="button" class="btn btn-xs btn-danger"
                id="epiRiskEstimate-delete" title="Delete row">
                <span class="glyphicon glyphicon-trash"></span></button>
    </td>
  </tr>
</template>

<template name="epiResultsModal">
  <div class="modal fade" id="epiResultsModal" tabindex="-1" role="dialog"
       aria-labelledby="epiResultsModal" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="epiResultsModal">Results data capture</h4>
        </div>
        <div class="modal-body">
          {{> epiResultsForm isModal=true }}
        </div>
      </div>
    </div>
  </div>
</template>
