<template name="epiOrganSiteOpts">
  {{#actionBtn}}
      {{> optFullScreen}}
      {{> optRiskPlot}}
      <li>
        <a href="#" id="selectVisible">
          <span class="fa fa-check-square-o"></span> Select visible
        </a>
      </li>
  {{/actionBtn}}
</template>


<template name="epiOrganSiteMain">
    {{#if Template.subscriptionsReady}}
      {{#contentContainer}}

        <!-- Header and pulldown list -->
        <h1>Volume {{volumeNumber}} {{monographAgent}}: epidemiology evidence
          {{> epiOrganSiteOpts}}
        </h1>

        <!-- Organ-site selector -->
        <div class="row">
          <form role="form" class="form-group">
            <div class="col-xs-12">
              <label>Filter results by organ site (ICD code)</label><br>
              <select multiple="true" class="form-control" id="organSiteSelector" style="height: 200px">
                {{{getOrganSiteOptions}}}
              </select>
              <p class="help-block">Select one or more organ-sites to view.</p>
            </div>
          </form>
        </div>

        <!-- Data-table -->
        <table class="evidenceTable table table-compressed">
          <colgroup>
            <col width="20%">
            <col width="15%">
            <col width="17%">
            <col width="8%">
            <col width="20%">
            <col width="20%">
          </colgroup>
          <thead>
            <tr>
              <th>Reference, location, follow-up/enrollment period, study-design</th>
              <th>Organ site<br>(ICD code)</th>
              <th>Exposure category<br> or level</th>
              <th>Exposed<br>cases/<br>deaths</th>
              <th class="riskTR">Risk estimate<br>(95% CI)</th>
              <th>Covariates controlled</th>
            </tr>
          </thead>
          <tbody>
            {{#each object_list}}
              {{#each addIndex riskEstimates}}
                {{#if equals i 0}}
                  {{> epiOrganSiteFullTr}}
                {{else}}
                  {{> epiOrganSiteResultTr}}
                {{/if}}
              {{/each}}
            {{/each}}
          </tbody>
        </table>

      {{/contentContainer}}
    {{else}}
      {{> isLoading}}
    {{/if }}
</template>


<template name="epiOrganSiteFullTr">
  <tr class="{{hideRow}}">
    <td rowspan="{{../riskEstimates.length}}">
      {{>printReference id=../desc.referenceID}}<br>
      {{{../desc.studyDesign}}}
      {{../desc.location}}<br>
      {{../desc.enrollmentDates}}<br>
      {{../desc.studyDesign}}
    </td>
    <td rowspan="{{../riskEstimates.length}}">
      {{../organSite}}
    </td>
    <td>
      {{v.exposureCategory}}
    </td>
    <td>
      {{v.numberExposed}}
    </td>
    <td>
      {{#if showPlots}}
        {{> forestPlot parent=.. index=i }}
      {{ else}}
        <span title="Effect measure: {{../effectMeasure}}">{{../riskFormatter v}}</span>
      {{/if}}
      {{#if showCheckbox}}
        <input class="hideRow pull-right" type="checkbox" {{rowVisible}}>
      {{/if}}
    </td>
    <td rowspan="{{../riskEstimates.length}}">
      {{commaList ../covariates}}
    </td>
  </tr>
</template>


<template name="epiOrganSiteResultTr">
  <tr class="{{hideRow}}">
    <td>
      {{v.exposureCategory}}
    </td>
    <td>
      {{v.numberExposed}}
    </td>
    <td>
      {{#if showPlots}}
        {{> forestPlot parent=.. index=i }}
      {{ else}}
        <span title="Effect measure: {{../effectMeasure}}">{{../riskFormatter v}}</span>
        {{#if showCheckbox}}
          <input class="hideRow pull-right" type="checkbox" {{rowVisible}}>
        {{/if}}
      {{/if}}
    </td>
  </tr>
</template>
