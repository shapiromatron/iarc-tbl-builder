<template name="ntpEpiMain">
  {{#if Template.subscriptionsReady}}
    {{#contentContainer}}
      {{> ntpEpiDescTbl}}
    {{/contentContainer}}
  {{else}}
    {{> isLoading}}
  {{/if }}
</template>


<template name="ntpEpiDescOpts">
  {{#actionBtn}}
      {{#if userCanEdit}}
        {{#unless showNew}}
          {{> optCreate }}
        {{/unless}}
        {{> optReorder }}
      {{/if}}
      {{> optMonoRefList}}
      {{> optFullScreen}}
      {{> optExcel }}
      {{> optWord }}
      {{> optRiskPlot}}
      {{> optShowAllRows}}
      {{> optQaFlags}}
  {{/actionBtn}}
</template>


<template name="ntpEpiDescTbl">
  <h1>{{name}} {{> ntpEpiDescOpts}}</h1>
  {{> tableTitle}}
  <table class="evidenceTable table table-compressed">
    <colgroup>
      <col width="15%">
      <col width="15%">
      <col width="10%">
      <col width="11%">
      <col width="06%">
      <col width="12%">
      <col width="10%">
      <col width="21%">
    </colgroup>
    <thead>
      <tr>
        <th>Reference, location, follow-up/enrollment period, study-design</th>
        <th>Population size, description, exposure assessment method</th>
        <th>Organ site<br>(ICD code)</th>
        <th>Exposure category<br> or level</th>
        <th>Exposed<br>cases/<br>deaths</th>
        <th class="riskTR">Risk estimate<br>(95% CI)</th>
        <th>Covariates controlled</th>
        <th>Comments</th>
      </tr>
    </thead>
    <tbody id="sortable">
      {{#each object_list}}
        {{> ntpEpiDescriptiveRow}}
      {{else}}
        <tr>
          <td colspan="100">No data has been entered into this table.</td>
        </tr>
      {{/each}}
    </tbody>
  </table>

  {{> showNewBtn }}

  {{#if showNew}}
    {{> ntpEpiDescriptiveForm isNew=true}}
  {{/if}}
</template>


<template name="ntpEpiDescriptiveRow">
  {{#if showRow isHidden}}
    <tr class="menu-autohide {{#if isHidden}}hiddenRow{{/if}}"
        data-id="{{_id}}"
        data-sortIdx="{{sortIdx}}">
      {{#if isEditing}}
        <td id="editingRow" colspan="100">
          {{> ntpEpiDescriptiveForm this isNew=false}}
        </td>
      {{else}}
        {{> ntpEpiDescriptiveTds}}
      {{/if}}
    </tr>
  {{/if}}
</template>


<template name="ntpEpiDescriptiveTds">
  <td>1</td>
  <td>2</td>
  <td>3</td>
  <td>4</td>
</template>


<template name="ntpEpiDescriptiveForm">
  <form id="mainForm" role="form" class="editForm">
    <legend>Epidemiological study description {{>formLegendPulldown}}</legend>
    <p class="help-block">Hover-over field labels for more descriptive text. Fields marked with an asterisk (<b>*</b>) are required.</p>

    <!-- TODO: add content THURS -->

    <div id="errors"></div>
    {{> qaNotice}}
    {{> submissionsDiv this showAddNested=true}}
  </form>
</template>


<!-- TODO: make this reusable THURS -->
<template name="submissionsDiv">
  <div class="well well-sm pager">
    {{#if isNew }}
      <button type="button"
              class="btn btn-sm btn-primary"
              id="create"
              title="Save new">
              <span class="glyphicon glyphicon-ok"></span> Create</button>
      <button type="button"
              class="btn btn-sm btn-default"
              id="create-cancel"
              title="Cancel">Cancel</button>
    {{else}}
      {{#if isQA }}
        <button type="button"
                class="btn btn-sm btn-default"
                id="update-cancel"
                title="Cancel changes">Close</button>
        {{#if isInRole 'staff'}}
          <button type ="button"
                    id   ="unsetQA"
                    class="pull-right btn btn-sm btn-warning"
                    title="Unset data as QA'd and allow further changes">
                    <span class="fa fa-exclamation-circle"></span> Remove QA'd</button>
        {{/if}}
      {{else}}
        <button type="button"
                class="btn btn-sm btn-primary"
                id="update"
                title="Save changes">
                <span class="glyphicon glyphicon-ok"></span> Save</button>
        <button type="button"
                class="btn btn-sm btn-default"
                id="update-cancel"
                title="Cancel changes">Cancel</button>
        <button type="button"
                class="btn btn-sm btn-danger"
                id="delete" title="Delete row">
                <span class="glyphicon glyphicon-trash"></span></button>
        {{# if showAddNested}}
          <button type ="button"
                  id   ="addNestedResult"
                  class="pull-left btn btn-sm btn-primary"
                  title="Display modal for entering results">
                  <span class="fa fa-medkit"></span> Add results</button>
        {{/ if }}
        {{#if isInRole 'staff'}}
          <button type ="button"
                  id   ="setQA"
                  class="pull-right btn btn-sm btn-success"
                  title="Make data as QA'd and prevent further changes">
                  <span class="fa fa-check-circle"></span> Mark QA'd</button>
        {{/if}}
      {{/if}}
    {{/if}}
  </div>
</template>
