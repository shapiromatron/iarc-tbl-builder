<template name="exposureMain">
  {{#if Template.subscriptionsReady}}
    {{#contentContainer}}
      {{> exposureTbl}}
    {{/contentContainer}}
  {{else}}
    {{> isLoading}}
  {{/if }}
</template>


<template name="exposureTblOpts">
  {{#actionBtn}}
      {{#if userCanEdit}}
        {{#unless showNew}}
          {{> optCreate }}
        {{/unless}}
        {{> optReorder }}
      {{/if}}
      {{> optMonoRefList }}
      {{> optFullScreen }}
      {{> optExcel }}
      {{> optWord }}
      {{> optShowAllRows }}
      {{> optQaFlags }}
  {{/actionBtn}}
</template>


<template name="exposureTbl">
  <h1>{{name}} {{> exposureTblOpts}}</h1>
  {{> tableTitle}}

  <table class="evidenceTable table table-compressed">
    <colgroup>
      <col width="15%">
      <col width="10%">
      <col width="10%">
      <col width="10%">
      <col width="15%">
      <col width="10%">
      <col width="30%">
    </colgroup>
    <thead>
      <tr>
        <th>Reference,<br>agent collected,<br>exposure-scenario</th>
        <th>Location, <br>collection date</th>
        <th>Occupation description</th>
        <th>Sampling<br>matrix</th>
        <th>Exposure level</th>
        <th>Exposure range</th>
        <th>Comments/additional data</th>
      </tr>
    </thead>
    <tbody id="sortable">
      {{#each object_list}}
        {{#if showRow isHidden}}
          <tr class="menu-autohide {{#if isHidden}}hiddenRow{{/if}}"
              data-id="{{_id}}"
              data-sortIdx="{{sortIdx}}">
            {{#if isEditing}}
              <td id="editingRow" colspan="100">
                {{> exposureForm this isNew=false}}
              </td>
            {{else}}
              {{> exposureRow}}
            {{/if}}
          </tr>
        {{/if}}
      {{else}}
        <tr>
          <td colspan="100">No data has been entered into this table.</td>
        </tr>
      {{/each}}
    </tbody>
  </table>

  {{> showNewBtn }}

  {{#if showNew}}
    {{> exposureForm isNew=true}}
  {{/if}}

</template>


<template name='exposureRow'>
  <td>
    {{#if userCanEdit}}
      <div class="rowOptions btn-group pull-right">
        <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown">
          <span class="caret" title="Editing options"></span>
        </button>
        <ul class="dropdown-menu">
          <li>
            <a href="#" id="show-edit">
              <span class="glyphicon glyphicon-edit"></span> Edit</a></li>
          <li>
            <a href="#" id="clone-content">
              <span class="fa fa-copy"></span> Create a clone</a></li>
          <li>
            <a href="#" id="move-content">
              <span class="fa fa-arrow-circle-right"></span> Move to a different table</a></li>
          <li>
              <a href="#" id="toggle-hidden">{{#if isHidden}}
                <span class="glyphicon glyphicon-plus"></span> Show row
                {{else}}<span class="glyphicon glyphicon-minus"></span> Hide row
                {{/if}}</a></li>
        </ul>
      </div>
    {{/if}}
    {{qaMark isQA}}
    {{>printReference id=referenceID}}<br>
    <span class="text-muted">{{exposureScenario}}</span><br>
    {{agent}}
  </td>
  <td>
    {{country}}<br>
    {{#if location}}
      <span class="text-muted">{{location}}</span><br>
    {{/if}}
    {{collectionDate}}
  </td>
  <td>

    {{#if isOccupational}}
      {{occupation}}<br>
      {{#if occupationInfo}}
        <span class="text-muted">{{occupationInfo}}</span>
      {{/if}}
    {{else}}
      N/A
    {{/if}}
  </td>
  <td>
    {{samplingMatrix}}
  </td>
  <td>
    {{exposureLevel}} {{units}}<br>
    <span class="text-muted">{{exposureLevelDescription}}</span>
  </td>
  <td>
    {{exposureLevelRange}} {{units}}
  </td>
  <td>
    {{comments}}
  </td>
  <td class="dragHandle dhOuter" style="display: none" title="Drag to re-order rows"></td>
</template>


<template name="exposureForm">
  <form id="mainForm" role="form" class="editForm">
    <legend>Exposure evidence{{> objectLastUpdated}}{{>formLegendPulldown}}</legend>
    <p class="help-block">Hover-over field labels for more descriptive text. Fields marked with an asterisk (<b>*</b>) are required.</p>

    <!-- First row -->
    <div class="form-group row">
      <div class="col-xs-3">
        {{> referenceSingleSelect}}
      </div>
      <div class="col-xs-3">
        {{> fldSelectSingle name="exposureScenario" value=exposureScenario }}<br>
        {{> fldInputText name="collectionDate" value=collectionDate }}
      </div>
      <div class="col-xs-3 isOcc">
        {{> fldInputText name="occupation" value=occupation }}<br>
        {{> fldInputText name="occupationInfo" value=occupationInfo }}
      </div>
      <div class="col-xs-3">
        {{> fldInputTypeahead name="country" value=country }}<br>
        {{> fldInputText name="location" value=location }}
      </div>
    </div>

    <!-- Second row -->
    <div class="form-group row">
      <div class="col-xs-3">
        <br>{{> fldInputTypeahead name="agent" value=agent }}
      </div>
      <div class="col-xs-3">
        <br>{{> fldInputTypeahead name="samplingMatrix" value=samplingMatrix }}
      </div>
      <div class="col-xs-2">
        <br>{{> fldSelectSingle name="samplingApproach" value=samplingApproach }}
      </div>
      <div class="col-xs-2">
        {{> fldInputText name="numberMeasurements" value=numberMeasurements }}
      </div>
      <div class="col-xs-2">
        <br>{{> fldInputText name="measurementDuration" value=measurementDuration }}
      </div>
    </div>

    <!-- Third row -->
    <div class="form-group row">
      <div class="col-xs-3">
        {{> fldInputText name="exposureLevel" value=exposureLevel }}
      </div>
      <div class="col-xs-3">
        {{> fldSelectSingle name="exposureLevelDescription" value=exposureLevelDescription }}
      </div>
      <div class="col-xs-3">
        {{> fldInputText name="exposureLevelRange" value=exposureLevelRange }}
      </div>
      <div class="col-xs-3">
        {{> fldInputTypeahead name="units" value=units }}
      </div>
    </div>

    <!-- Fourth row -->
    <div class="form-group row">
      <div class="col-xs-12">
        {{> fldTextArea name="comments" value=comments }}
      </div>
    </div>

    <div id="errors"></div>
    {{> qaNotice}}
    {{> evidenceFormSubmissionDiv }}
  </form>
  <!-- Add input form-modals outside form scope -->
  {{> referenceQuickAddModal}}
</template>
