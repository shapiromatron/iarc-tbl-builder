<template name="my_lists">
  <div class="container">
    {{> myTbl }}
  </div>
</template>

<template name="myTbl">
  <h1>Tables which I've created.
    <div class="btn-group pull-right">
      <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown">
        <span class="caret" title="Editing options"></span>
      </button>
      <ul class="dropdown-menu">
        {{#unless showNew}}
          <li><a href="#" id="myTbl-show-create"><span class="glyphicon glyphicon-plus"></span> New</a></li>
        {{/unless}}
      </ul>
    </div>
  </h1>

  <table class="table table-compressed table-striped">
    <thead>
      <tr>
        <th>Name and Hyperlink</th>
        <th>Table Type</th>
        <th>Secret Password</th>
        <th>Created</th>
        <th>Settings</th>
      </tr>
    </thead>
    <tbody>
      {{#each getMyTbls}}
        <tr>
          {{#if isEditing}}
            <td id="editingRow" colspan="100">
              {{> myTblForm}}
            </td>
          {{else}}
            <td><a href="{{getURL}}">{{name}}</a></td>
            <td>{{tblType}}</td>
            <td>{{passwd}}</td>
            <td>{{formatDate timestamp "long"}}</td>
            <td><a class="btn btn-default" href="#" id="myTbl-show-edit"><span class="glyphicon glyphicon-edit"></span> Edit</a></td>
          {{/if}}
        </tr>
      {{else}}
        {{#unless showNew}}
          <tr>
            <td colspan="100">You haven't created any tables yet.<br><br>
              <a href="#" class="btn btn-primary btn-sm" id="myTbl-show-create"><span class="glyphicon glyphicon-plus"></span> Create new</a>
            </td>
          </tr>
        {{/unless}}
      {{/each}}
    </tbody>
  </table>

  {{#if showNew}}
    {{> myTblForm}}
  {{/if}}
</template>

<template name="myTblForm">
  <form id="myTblForm" role="form" class="editForm">
    <div class="form-group">
      <label>Table Name</label>
      <input class="form-control" name='name' type="text" value="{{name}}"/>
    </div>
    <div class="form-group">
      <label>Table Type</label>
      <select class="form-control" name='tblType' type="text">
        <option selected={{TblTypeSelected prev=tblType opt="Epidemiology - Cohort"}} >Epidemiology - Cohort</option>
        <option selected={{TblTypeSelected prev=tblType opt="Epidemiology - Case Control"}} >Epidemiology - Case Control</option>
      </select>
    </div>
    <div class="form-group">
      <label>Secret password</label>
      <input class="form-control" name='passwd' type="text" value="{{passwd}}"/>
    </div>

    <div class="well well-sm pager">
      {{#if _id}}
        <button type="button" class="btn btn-sm btn-primary" id="myTbl-update" title="Save changes"><span class="glyphicon glyphicon-ok"></span> Save</button>
        <button type="button" class="btn btn-sm btn-default" id="myTbl-update-cancel" title="Cancel changes">Cancel</button>
        <button type="button" class="btn btn-sm btn-danger"  id="myTbl-delete" title="Delete row"><span class="glyphicon glyphicon-trash"></span></button>
      {{else}}
        <button type="button" class="btn btn-sm btn-primary" id="myTbl-create" title="Save new"><span class="glyphicon glyphicon-ok"> Create</span></button>
        <button type="button" class="btn btn-sm btn-default" id="myTbl-create-cancel" title="Cancel">Cancel</button>
      {{/if}}
    </div>
  </form>
</template>
