<template name="my_lists">
    <div class="container">
        <h1>My available lists.</h1>
        {{> myTbl }}
        <a href="{{pathFor 'in_vitro'}}">In vitro!</a>
    </div>
</template>

<template name="in_vitro">
    <div class="container">
        <table id="iv_tbl" class="table table-striped table-condensed">
            {{> refs_thead}}
            {{> refs_tbody}}
        </table>
        {{> refs_newform}}
    </div>
    <a href="{{pathFor 'my_lists'}}">View my lists</a>
</template>

<!-- START REFERENCE TEMPLATES -->

<template name="refs_thead">
    <colgroup>
        <col style="width:15%">
        <col style="width:15%">
        <col style="width:10%">
        <col style="width:10%">
        <col style="width:25%">
        <col style="width:15%">
        <col style="width:10%">
    </colgroup>
    <thead>
        <tr>
            <th rowspan="2">Test system</th>
            <th rowspan="2">Substance tested</th>
            <th colspan="2">Results</th>
            <th rowspan="2">Comment</th>
            <th rowspan="2">Reference</th>
            <th rowspan="2">Settings</th>
        </tr>
        <tr>
            <th>Without exogenous<br>metabolic activation</th>
            <th>With exogenous<br>metabolic activation</th>
        </tr>
    </thead>
</template>

<template name="refs_tbody">
    <tbody>
        {{#each references}}
            {{#if show_row }}
                <tr data-idx="{{_idx}}" data-id="{{_id}}" class="{{isDisplayClass}}">
                    {{#if editing}}
                        <td colspan="100">
                            {{> refs_form}}
                        </td>
                    {{else}}
                        {{> refs_display}}
                    {{/if}}
                </tr>
            {{/if}}
        {{/each}}
    </tbody>
</template>

<template name="refs_display">
    <td>{{test_system}}</td>
    <td>{{substance_tested}}</td>
    <td>{{result_without}}</td>
    <td>{{result_with}}</td>
    <td>{{comment}}</td>
    <td>{{> rr_tbl editable="F" ref_id=_id}}</td>
    <td>{{reference}}</td>
    <td>
        <div class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Action <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#" id="citation-select-edit"><span class="glyphicon glyphicon-edit"></span> Edit</a></li>
            <li><a href="#" id="ref-move-up"><span class="glyphicon glyphicon-arrow-up"></span> Move up</a></li>
            <li><a href="#" id="ref-move-down"><span class="glyphicon glyphicon-arrow-down"></span> Move down</a></li>
          </ul>
        </div>
    </td>
</template>

<template name="refs_form">
    <form role="form">
        <div class="form-group">
            <label>Test System</label>
            <input class="form-control" name='test_system' type="text" value="{{test_system}}"/>
        </div>
        <div class="form-group">
            <label>Substance Tested</label>
            <input class="form-control" name='substance_tested' type="text" value="{{substance_tested}}"/>
        </div>
        <div class="form-group">
            <label>Result Without</label>
            <input class="form-control" name='result_without' type="text" value="{{result_without}}" placeholder='Should be one of the following: +, -, NT'/>
        </div>
        <div class="form-group">
            <label>Result With</label>
            <input class="form-control" name='result_with' type="text" value="{{result_with}}" placeholder='Should be one of the following: +, -, NT'/>
        </div>
        <div class="form-group">
            <label>Comment</label>
            <input class="form-control" name='comment' type="text" value="{{comment}}"/>
        </div>
        <div class="form-group">
            <label>Reference</label>
            <input class="form-control" name='reference' type="text" value="{{reference}}"/>
        </div>
        <div class="checkbox">
            <label>Display</label>
            <input name='_display' type="checkbox" {{isDisplay}} />
        </div>
    </form>
    {{#if _id}}
        {{> rr_tbl editable="T" ref_id=_id }}
        <button type="button" class="btn btn-sm btn-primary" id="save-settings" title="Save changes"><span class="glyphicon glyphicon-ok"> Save</span></button>
        <button type="button" class="btn btn-sm btn-default" id="cancel-save" title="Cancel changes">Cancel</button>
        <button type="button" class="btn btn-sm btn-danger"  id="delete" title="Delete row"><span class="glyphicon glyphicon-trash"></span></button>
    {{else}}
        <button type="button" class="btn btn-sm btn-primary" id="create-new" title="Save new"><span class="glyphicon glyphicon-ok"> Create</span></button>
        <button type="button" class="btn btn-sm btn-default" id="cancel-new" title="Cancel">Cancel</button>
    {{/if}}
</template>

<template name="refs_newform">

    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Action <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li><a href="#" id="show-all-rows">Toggle show all rows</a></li>
        <li><a href="#" id="download-excel">Download Excel</a></li>
      </ul>
    </div>

    {{#if show_new}}
        {{> refs_form}}
    {{else}}
        <button id="display_form" class="btn btn-small btn-primary">Add</button>
    {{/if}}
</template>

<!-- START RR TEMPLATES -->

<template name="rr_tbl">
    <table class="table table-striped table-condensed">
        <thead>
            <th>Name</th>
            <th>Estimate</th>
        </thead>
        <tbody>
            {{#each relRisks }}
                <tr>
                    {{#if isEditing}}
                        <td colspan="100">{{> rr_form}}</td>
                    {{else}}
                        <!-- Display view -->
                        <td>{{name}}</td>
                        <td>{{mid}} ({{low}}, {{high}})</td>
                        {{#if showEdit ../editable }}
                            <td>
                                <a href="#" id="rr-toggle-edit">Edit</a>
                            </td>
                        {{/if}}
                    {{/if}}
                </tr>
            {{/each}}
        </tbody>
    </table>
    {{#if showEdit editable }}
        {{#if rr_shownew}}
            {{> rr_form }}
        {{else}}
            <button id="rr-new-form" class="btn btn-small btn-primary">Add</button><br>
        {{/if}}
    {{/if}}
</template>

<template name="rr_form">
    <form class="form-inline" role="form">
        <div class="form-group">
            <input name="ref_id" type="hidden" value="{{ref_id}}" />
            <label>Name</label>
            <input class="form-control" name='name' type="text" value="{{name}}"/>
        </div>
        <div class="form-group">
            <label>Low</label>
            <input class="form-control" name='low' type="text" value="{{low}}"/>
        </div>
        <div class="form-group">
            <label>Mid</label>
            <input class="form-control" name='mid' type="text" value="{{mid}}"/>
        </div>
        <div class="form-group">
            <label>High</label>
            <input class="form-control" name='high' type="text" value="{{high}}"/>
        </div>
        {{#if _id}}
            <button type="button" class="btn btn-sm btn-primary" id="rr-update"><span class="glyphicon glyphicon-ok"> Update</span></button>
            <button type="button" class="btn btn-sm btn-default" id="rr-update-cancel">Cancel</button>
            <button type="button" class="btn btn-sm btn-danger"  id="rr-delete"><span class="glyphicon glyphicon-trash"></span></button>
        {{else}}
            <button type="button" class="btn btn-sm btn-primary" id="rr-create">Create</button>
            <button type="button" class="btn btn-sm btn-default" id="rr-create-cancel">Cancel</button>
        {{/if}}
    </form>
</template>
