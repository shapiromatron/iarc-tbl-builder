<template name="home">
  <div class="container">
  {{#if currentUser}}
      {{> volumesList}}
    {{else }}
      {{> notLoggedIn}}
    {{/if}}
  </div>
</template>


<template name="notLoggedIn">
  <div class="row">
      {{#if equals appFlavor 'iarc' }}
        {{> iarcIntro}}
      {{/if }}

      {{#if equals appFlavor 'ntp' }}
        {{> ntpIntro}}
      {{/if }}

      {{#if equals appFlavor 'demo' }}
        {{> demoIntro}}
      {{/if }}
  </div>
</template>

<template name='iarcIntro'>
  <div class="col-md-offset-1 col-md-7">
    <h1>Welcome to IARC table builder!</h1>
    <p>
        The <a href="http://monographs.iarc.fr/">IARC Monographs</a>, prepared by expert working groups for the WHO International Agency for Research on Cancer (IARC), identify environmental factors that can increase the risk of human cancer. These include chemicals, complex mixtures, occupational exposures, physical agents, biological agents, and lifestyle factors. National health agencies can use this information as scientific support for their actions to prevent exposure to potential carcinogens.
    </p>
    <p>
        This web-application is designed to assist the interdisciplinary working group in writing the monographs. Specifically, as the name suggests, it's primary goal is to produce evidence tables from peer-reviewed literature. However, in addition to generating summary tables for reporting, it also enables interactive exploration which can be helpful in determining how to draw conclusions on the data as monographs are being developed.
    </p>
    <p>
        To begin, you'll need to sign-in. Without authenticating, you won't be able to view or edit any content on the site. For help, please <a href="mailto:{{contactEmail}}">contact us</a>.
    </p>
  </div>
</template>

<template name='ntpIntro'>
  <div class="col-md-offset-1 col-md-7">
    <h1>Welcome to NTP table builder!</h1>
    <p>
        The <a href="https://ntp.niehs.nih.gov/pubhealth/roc/index.html">Report on Carcinogens</a> (RoC) is a congressionally mandated, science-based, public health report that identifies agents, substances, mixtures, or exposures (collectively called "substances") in our environment that pose a hazard to people residing in the United States. The National Toxicology Program (NTP) prepares the report on behalf of the Secretary, Health and Human Services.
    </p>
    <p>
        This web-application is designed to assist the interdisciplinary working group in writing these reports. Specifically, as the name suggests, it's primary goal is to produce evidence tables from peer-reviewed literature. However, in addition to generating summary tables for reporting, it also enables interactive exploration which can be helpful in determining how to draw conclusions on the data as reports are being developed.
    </p>
    <p>
        To begin, you'll need to sign-in. Without authenticating, you won't be able to view or edit any content on the site. For help, please <a href="mailto:{{contactEmail}}">contact us</a>.
    </p>
  </div>
</template>


<template name='demoIntro'>
  <div class='col-md-12'>
    <h1>Welcome to DEMO table builder!</h1>
  </div>

  <div class="col-md-7">
    <p>
        The <a href="http://monographs.iarc.fr/">IARC Monographs</a>, prepared by expert working groups for the WHO International Agency for Research on Cancer (IARC), identify environmental factors that can increase the risk of human cancer. These include chemicals, complex mixtures, occupational exposures, physical agents, biological agents, and lifestyle factors. National health agencies can use this information as scientific support for their actions to prevent exposure to potential carcinogens.
    </p>
    <p>
        The <a href="https://ntp.niehs.nih.gov/pubhealth/roc/index.html">Report on Carcinogens</a> (RoC) is a congressionally mandated, science-based, public health report that identifies agents, substances, mixtures, or exposures (collectively called "substances") in our environment that pose a hazard to people residing in the United States. The National Toxicology Program (NTP) prepares the report on behalf of the Secretary, Health and Human Services.
    </p>
    <p>
        This web-application is designed to assist the interdisciplinary working group in writing these reports. Specifically, as the name suggests, it's primary goal is to produce evidence tables from peer-reviewed literature. However, in addition to generating summary tables for reporting, it also enables interactive exploration which can be helpful in determining how to draw conclusions on the data as reports are being developed.
    </p>
    <p>
        To begin, you'll need to sign-in. Without authenticating, you won't be able to view or edit any content on the site. For help, please <a href="mailto:{{contactEmail}}">contact us</a>.
    </p>
  </div>
  <div class='col-md-5'>
    <div class='alert alert-info'>
      <p><b>This is a demo!</b></p>
      <p>This website is a demonstration of the table-builder software; it's not designed for use on a real assessment. For more details on the website, please review Shapiro et al. 2018 <i>(submitted)</i>. If you want to use for your own work, you'll need to setup your own copy of Table Builder; we can help!</p>
      <p><b>Data are reset on the website every 7 days.</b></p>
      <p>However, you're free to login to the software to take it for a spin. Once logged-in, you can view tables, explore data, and download reports for data which his been extracted. You could also view the data extraction forms for the various evidence types.</p>
      <br>
      <p><u>Login as a <b>team member</b>:</u></p>
      <ul>
        <li><b>Email:</b> <code>demo@table-builder.com</code></li>
        <li><b>Password:</b> <code>mcdemo</code></li>
      </ul>
      <p>
        Team members can add new references to projects and can edit and view content in tables which they've been given access to by staff members.
      </p>
      <br>
      <p><u>Login as a <b>staff member</b> (please be nice):</u></p>
      <ul>
        <li><b>Email:</b> <code>staff@table-builder.com</code></li>
        <li><b>Password:</b> <code>mcstaff</code></li>
      </ul>
      <p>
        Staff members can create new tables, assign team-members to tables, and can download reports of the data.
      </p>
    </div>
  </div>
</template>


<template name="tableOpts">
  {{#if isInRole 'staff'}}
    {{#actionBtn}}
        {{#unless showNew}}
          <li>
            <a href="#" id="tables-show-create">
              <i class="fa fa-fw fa-plus"></i> New table</a></li>
        {{/unless}}

        {{#if canSort}}
        <li>
          <a href="#" id="reorderRows">
            <i class="fa fa-fw fa-align-justify"></i> Reorder tables</a></li>
        {{/if}}
    {{/actionBtn}}
  {{/if}}
</template>


<template name="newTableHolder">
  <div class="col-md-offset-1 col-md-10">
    <h1>Create a new evidence table {{>tableOpts canSort=false}}</h1>
    {{> tablesForm}}
  </div>
</template>


<template name="volumesList">
  <div class="row">
    {{#if showNew}}
      {{> newTableHolder}}
    {{else}}
      <div class="col-md-offset-1 col-md-10">
        <h1>Current volumes {{>tableOpts canSort=false}}</h1>
        <ul class="volumeList">
          {{#each getMonographs}}
            <li class="volumeItem">
              <a href="{{pathFor 'volumeTableList' volumeNumber=this}}"
                 class="noUnderline noColor">
                <h3 class="volumeName">Volume {{this}}</h3>
                <p class="agentList">{{getMonographAgents this}}</p></a></li>
          {{else}}
            <li>You don't have access to any evidence tables.
                You must have <code>staff</code> access to create new tables.</li>
          {{/each}}
        </ul>
      </div>
    {{/if}}
  </div>
</template>


<template name="volumeTableList">
  <div class="container">
    <div class="row">
      {{#if showNew}}
        {{> newTableHolder}}
      {{else}}
        <div class="col-md-offset-1 col-md-10">
          <h1>Volume {{volumeNumber}} {{>tableOpts canSort=true}}</h1>
          {{#each getMonographAgents this}}
            {{> agentBanner}}
            <div class="tableContainer sortables">
              {{#each getTables ../volumeNumber this }}
                {{#if isEditing}}
                  {{> tablesForm}}
                {{else}}
                  {{> tableItem}}
                {{/if}}
              {{/each}}
            </div>
          {{/each}}
        </div>
      {{/if}}
    </div>
  </div>
</template>


<template name="agentBanner">
  <div class="agentBanner">
    <h3 id="{{this}}" class= "menu-autohide">{{this}}
      <div class="rowOptions btn-group pull-right">
        <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown">
          <span class="caret" title="Editing options"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
              <a href="{{pathFor 'referencesMain' monographAgent=this}}">
                <span class="fa fa-book"></span> View references</a></li>
            <li>
              <a href="{{pathFor 'epiOrganSiteMain' volumeNumber=../volumeNumber monographAgent=this}}">
                <i class="fa fa-tachometer"></i> Epi data by organ-site</a></li>
        </ul>
      </div>
    </h3>
  </div>
</template>


<template name="tableItem">
  <div class="moveTableHolder"
     data-id="{{_id}}"
     data-sortIdx="{{sortIdx}}">
  <span class="moveTableHandle" style="display: none" title="Drag to re-order rows"></span>
  <a class="noUnderline" href="{{getURL}}">
    <div class="tableDiv menu-autohide {{getActiveTableClass}}">
      <span class="label label-default">{{tblType}}</span>
      {{#if canEdit}}
        <div class="rowOptions btn-group pull-right">
          <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown">
            <span class="caret" title="Editing options"></span>
          </button>
          <ul class="dropdown-menu">
              <li><a href="#" id="tables-show-edit"><span class="glyphicon glyphicon-edit"></span> Edit</a></li>
              <li><a href="#" id="clone"><span class="fa fa-copy"></span> Create a clone</a></li>
          </ul>
        </div>
      {{/if}}
      <br>{{name}}
      <span class="label pull-right statusLabel {{getStatusColorClass this}}">Status: {{status}}</span>
      {{{showDebugInformation _id sortIdx}}}
    </div>
  </a>
</div>
</template>


<template name="tablesForm">
  <form id="tablesForm" role="form" class="editForm">

    <p class="help-block">Fields marked with an asterisk (<b>*</b>) are required.</p>

    <div class="form-group row">
      <div class="col-xs-3">
        <label>Volume Number*</label>
        <input class="form-control" name='volumeNumber' type="number" value="{{volumeNumber}}"/>
      </div>
      <div class="col-xs-5">
        <label>Monograph Agent Name*</label>
        {{> typeaheadInput name="monographAgent" value=monographAgent methodName="searchMonographAgent"}}
      </div>
      <div class="col-xs-4">
        <label>Table Type*</label>
        {{> selectList options=getTblTypeOptions selected=tblType selectName="tblType" }}
      </div>
    </div>
    <div class="form-group">
      <label>Table Name*</label>
      <input class="form-control" name='name' type="text" value="{{name}}"/>
    </div>
    <div class="form-group row">
      <div class="col-xs-4">
        {{> typeaheadUserSelect label="Project managers" name="projectManagers" helpText="Can change permissions for who has access." tbl=this}}
      </div>
      <div class="col-xs-4">
        {{> typeaheadUserSelect label="Team members" name="teamMembers" helpText="Can create/change/delete content for a selected table." tbl=this}}
      </div>
      <div class="col-xs-4">
        {{> typeaheadUserSelect label="Reviewers" name="reviewers" helpText="Can view but not change content." tbl=this}}
      </div>
    </div>
    <div class="form-group row">
      <div class="col-xs-4">
        <label>Table Status*</label>
        {{> selectList options=getStatusOptions selected=status selectName="status" }}
      </div>
    </div>

    <div id="errors"></div>

    <div class="well well-sm pager">
      {{#if _id}}
        <button type="button"
                class="btn btn-sm btn-primary"
                id="tables-update"
                title="Save changes">
          <span class="glyphicon glyphicon-ok"></span> Save</button>
        <button type="button"
                class="btn btn-sm btn-default"
                id="tables-update-cancel"
                title="Cancel changes">Cancel</button>
        <button type="button"
                class="btn btn-sm btn-danger"
                id="tables-delete"
                title="Delete row">
          <span class="fa {{getDeleteIcon}}"></span></button>
      {{else}}
        <button type="button"
                class="btn btn-sm btn-primary"
                id="tables-create"
                title="Save new">
          <span class="glyphicon glyphicon-ok"></span> Create</button>
        <button type="button"
                class="btn btn-sm btn-default"
                id="tables-create-cancel"
                title="Cancel">Cancel</button>
      {{/if}}
    </div>
  </form>
</template>
